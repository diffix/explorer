httpInteractions:
- request:
    method: POST
    uri: https://attack.aircloak.com/api/queries
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"statement":"\r\n                        select\r\n                            payments,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by payments","data_source_name":"gda_banking"}}
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:38 GMT
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZPyaBcdGthg6d2iB
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
      Content-Length:
      - 66
    body:
      encoding: UTF8-8BIT
      text: |-
        {"success":true,"query_id":"e02705a8-338c-44d7-8cfc-524409bdda6f"}
- request:
    method: GET
    uri: https://attack.aircloak.com/api/queries/e02705a8-338c-44d7-8cfc-524409bdda6f
    body:
      encoding: ''
      text: ""
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:38 GMT
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZQF7RTRGthg6d2jB
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"buckets_link":"/queries/e02705a8-338c-44d7-8cfc-524409bdda6f/buckets","completed":false,"data_source":{"name":"gda_banking"},"data_source_id":9,"id":"e02705a8-338c-44d7-8cfc-524409bdda6f","inserted_at":"2020-02-12T20:42:38.163986","private_permalink":"/permalink/private/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAHcHJpdmF0ZWQABXF1ZXJ5bQAAACRlMDI3MDVhOC0zMzhjLTQ0ZDctOGNmYy01MjQ0MDliZGRhNmZkAAZzaWduZWRuBgAiqyM7cAE.E-di_efKQNLGDOUnrBOW4MRXRxH7DpZUndr6BprSDag","public_permalink":"/permalink/public/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAGcHVibGljZAAFcXVlcnltAAAAJGUwMjcwNWE4LTMzOGMtNDRkNy04Y2ZjLTUyNDQwOWJkZGE2ZmQABnNpZ25lZG4GACOrIztwAQ.-LhI_2DJ68Vx-ctIlfDZHv5nbNeB2StD9sx0Qxn9QNQ","query_state":"parsing","session_id":null,"statement":"\r\n                        select\r\n                            payments,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by payments","user":{"name":"Andrei Bozântan"},"rows":[]}}
- request:
    method: GET
    uri: https://attack.aircloak.com/api/queries/e02705a8-338c-44d7-8cfc-524409bdda6f
    body:
      encoding: ''
      text: ""
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:40 GMT
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZX0TyDAqqhs6d2pB
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"buckets_link":"/queries/e02705a8-338c-44d7-8cfc-524409bdda6f/buckets","completed":true,"data_source":{"name":"gda_banking"},"data_source_id":9,"id":"e02705a8-338c-44d7-8cfc-524409bdda6f","inserted_at":"2020-02-12T20:42:38.163986","private_permalink":"/permalink/private/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAHcHJpdmF0ZWQABXF1ZXJ5bQAAACRlMDI3MDVhOC0zMzhjLTQ0ZDctOGNmYy01MjQ0MDliZGRhNmZkAAZzaWduZWRuBgA8syM7cAE.XoEBF8X-Poq4MyO45W-kvdPxj7hFyhiyUYb51iR44mI","public_permalink":"/permalink/public/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAGcHVibGljZAAFcXVlcnltAAAAJGUwMjcwNWE4LTMzOGMtNDRkNy04Y2ZjLTUyNDQwOWJkZGE2ZmQABnNpZ25lZG4GADyzIztwAQ.AKXqgxaKMVRCixA3mHhCPmOx9PUttJ_I91TVuFuaqmA","query_state":"completed","session_id":null,"statement":"\r\n                        select\r\n                            payments,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by payments","user":{"name":"Andrei Bozântan"},"columns":["payments","count","count_noise"],"error":null,"info":["[Debug] Using statistics-based anonymization.","[Debug] Query executed in 0.145 seconds."],"log":"2020-02-12 20:42:38.000 [debug] Running statement `\r\n                        select\r\n                            payments,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by payments` ...\n2020-02-12 20:42:38.000 [debug] Query e02705a8-338c-44d7-8cfc-524409bdda6f state changed to: parsing...\n2020-02-12 20:42:38.000 [debug] Query e02705a8-338c-44d7-8cfc-524409bdda6f state changed to: compiling...\n2020-02-12 20:42:38.000 [debug] Query e02705a8-338c-44d7-8cfc-524409bdda6f state changed to: awaiting_data...\n2020-02-12 20:42:38.000 [debug] Offloading query ...: `SELECT \"__ac_regular_stats\".\"__ac_count_duid\",\"__ac_regular_stats\".\"__ac_group_0\",\"__ac_regular_stats\".\"__ac_agg_0_count\",\"__ac_regular_stats\".\"__ac_agg_0_sum\",\"__ac_regular_stats\".\"__ac_agg_0_min\",\"__ac_regular_stats\".\"__ac_agg_0_max\",\"__ac_regular_stats\".\"__ac_agg_0_stddev\",\"__ac_regular_stats\".\"__ac_grouping_id\",\"__ac_regular_stats\".\"__ac_min_uid\",\"__ac_regular_stats\".\"__ac_max_uid\",\"__ac_regular_stats\".\"__ac_nlc__1\" AS \"__ac_nlc__1\" FROM (SELECT \"__ac_uid_grouping\".\"__ac_grouping_id\" AS \"__ac_grouping_id\",\"__ac_uid_grouping\".\"__ac_group_0\" AS \"__ac_group_0\",COUNT(\"__ac_uid_grouping\".\"uid\") AS \"__ac_count_duid\",MIN(\"__ac_uid_grouping\".\"uid\") AS \"__ac_min_uid\",MAX(\"__ac_uid_grouping\".\"uid\") AS \"__ac_max_uid\",COUNT(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_count\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_sum\",MIN(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_min\",MAX(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_max\",STDDEV(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_stddev\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_nlc__1\" FROM (SELECT \"loans\".\"uid\" AS \"uid\",CASE WHEN \"loans\".\"payments\" < 50 THEN 50 WHEN \"loans\".\"payments\" > 100000 THEN 100000 ELSE \"loans\".\"payments\" END AS \"__ac_group_0\",COUNT(*) AS \"__ac_agg_0\",0 AS \"__ac_grouping_id\" FROM \"loans\" WHERE NOT (\"loans\".\"uid\" IS NULL) GROUP BY \"loans\".\"uid\", CASE WHEN \"loans\".\"payments\" < 50 THEN 50 WHEN \"loans\".\"payments\" > 100000 THEN 100000 ELSE \"loans\".\"payments\" END) AS \"__ac_uid_grouping\" GROUP BY \"__ac_uid_grouping\".\"__ac_grouping_id\", \"__ac_uid_grouping\".\"__ac_group_0\") AS \"__ac_regular_stats\" GROUP BY \"__ac_regular_stats\".\"__ac_group_0\"` ...\n2020-02-12 20:42:38.000 [debug] Selecting data ...\n2020-02-12 20:42:38.000 [debug] Acquiring connection to `gda_banking` ...\n2020-02-12 20:42:38.000 [debug] Anonymizing query result ...\n2020-02-12 20:42:38.000 [debug] Executing SQL query: SELECT \"__ac_regular_stats\".\"__ac_count_duid\",\"__ac_regular_stats\".\"__ac_group_0\",\"__ac_regular_stats\".\"__ac_agg_0_count\",\"__ac_regular_stats\".\"__ac_agg_0_sum\",\"__ac_regular_stats\".\"__ac_agg_0_min\",\"__ac_regular_stats\".\"__ac_agg_0_max\",\"__ac_regular_stats\".\"__ac_agg_0_stddev\",\"__ac_regular_stats\".\"__ac_grouping_id\",\"__ac_regular_stats\".\"__ac_min_uid\",\"__ac_regular_stats\".\"__ac_max_uid\",\"__ac_regular_stats\".\"__ac_nlc__1\" AS \"__ac_nlc__1\" FROM (SELECT \"__ac_uid_grouping\".\"__ac_grouping_id\" AS \"__ac_grouping_id\",\"__ac_uid_grouping\".\"__ac_group_0\" AS \"__ac_group_0\",COUNT(\"__ac_uid_grouping\".\"uid\") AS \"__ac_count_duid\",MIN(\"__ac_uid_grouping\".\"uid\") AS \"__ac_min_uid\",MAX(\"__ac_uid_grouping\".\"uid\") AS \"__ac_max_uid\",COUNT(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_count\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_sum\",MIN(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_min\",MAX(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_max\",STDDEV(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_stddev\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_nlc__1\" FROM (SELECT \"loans\".\"uid\" AS \"uid\",CASE WHEN \"loans\".\"payments\" < 50 THEN 50 WHEN \"loans\".\"payments\" > 100000 THEN 100000 ELSE \"loans\".\"payments\" END AS \"__ac_group_0\",COUNT(*) AS \"__ac_agg_0\",0 AS \"__ac_grouping_id\" FROM \"loans\" WHERE NOT (\"loans\".\"uid\" IS NULL) GROUP BY \"loans\".\"uid\", CASE WHEN \"loans\".\"payments\" < 50 THEN 50 WHEN \"loans\".\"payments\" > 100000 THEN 100000 ELSE \"loans\".\"payments\" END) AS \"__ac_uid_grouping\" GROUP BY \"__ac_uid_grouping\".\"__ac_grouping_id\", \"__ac_uid_grouping\".\"__ac_group_0\") AS \"__ac_regular_stats\"\n2020-02-12 20:42:38.000 [debug] Query e02705a8-338c-44d7-8cfc-524409bdda6f state changed to: ingesting_data...\n2020-02-12 20:42:38.000 [debug] Terminating streamer process\n2020-02-12 20:42:38.000 [debug] Returning the connection to the pool\n2020-02-12 20:42:38.000 [debug] Initializing anonymizer ...\n2020-02-12 20:42:38.000 [debug] Query e02705a8-338c-44d7-8cfc-524409bdda6f state changed to: processing...\n2020-02-12 20:42:38.000 [debug] Processing low count users ...\n2020-02-12 20:42:38.000 [debug] Aggregating groups ...\n2020-02-12 20:42:38.000 [debug] Making explicit buckets ...\n2020-02-12 20:42:38.000 [debug] Query e02705a8-338c-44d7-8cfc-524409bdda6f state changed to: post_processing...\n2020-02-12 20:42:38.000 [info] JSON_LOG {\"execution_time\":146,\"query_id\":\"e02705a8-338c-44d7-8cfc-524409bdda6f\",\"status\":\"Successful.\",\"type\":\"query_complete\"}\n2020-02-12 20:42:38.000 [info] query finished\n","row_count":20,"types":["real","integer","real"],"rows":[{"unreliable":false,"row":["*",758,1.4500000000000002],"occurrences":1},{"unreliable":true,"row":[1489.0,2,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[3698.0,2,null],"occurrences":1},{"unreliable":true,"row":[3900.0,2,null],"occurrences":1},{"unreliable":true,"row":[6908.0,2,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[2785.0,2,null],"occurrences":1},{"unreliable":true,"row":[2523.0,5,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[3874.0,3,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[7370.0,7,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[7636.0,4,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[1951.0,2,null],"occurrences":1},{"unreliable":true,"row":[5354.0,5,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[4340.0,2,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[3242.0,2,null],"occurrences":1},{"unreliable":true,"row":[5228.0,2,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[3151.0,2,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[3017.0,2,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[3373.0,4,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[6484.0,3,1.4000000000000001],"occurrences":1},{"unreliable":true,"row":[2931.0,2,1.4000000000000001],"occurrences":1}]}}
