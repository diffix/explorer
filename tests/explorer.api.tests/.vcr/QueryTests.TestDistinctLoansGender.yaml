httpInteractions:
- request:
    method: POST
    uri: https://attack.aircloak.com/api/queries
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"statement":"\r\n                        select\r\n                            gender,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by gender","data_source_name":"gda_banking"}}
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:35 GMT
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZFsqTRZGthg6d2aB
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
      Content-Length:
      - 66
    body:
      encoding: UTF8-8BIT
      text: |-
        {"success":true,"query_id":"355f98ed-57a1-4057-82ef-304642fc2198"}
- request:
    method: GET
    uri: https://attack.aircloak.com/api/queries/355f98ed-57a1-4057-82ef-304642fc2198
    body:
      encoding: ''
      text: ""
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:35 GMT
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZGLTrvdGthg3dQuC
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"buckets_link":"/queries/355f98ed-57a1-4057-82ef-304642fc2198/buckets","completed":false,"data_source":{"name":"gda_banking"},"data_source_id":9,"id":"355f98ed-57a1-4057-82ef-304642fc2198","inserted_at":"2020-02-12T20:42:35.453172","private_permalink":"/permalink/private/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAHcHJpdmF0ZWQABXF1ZXJ5bQAAACQzNTVmOThlZC01N2ExLTQwNTctODJlZi0zMDQ2NDJmYzIxOThkAAZzaWduZWRuBgC9oCM7cAE.RBrplsrqMgOg1Y16qZzpMiz47s7Fzj4y4j4RwK1Yduw","public_permalink":"/permalink/public/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAGcHVibGljZAAFcXVlcnltAAAAJDM1NWY5OGVkLTU3YTEtNDA1Ny04MmVmLTMwNDY0MmZjMjE5OGQABnNpZ25lZG4GAL2gIztwAQ.HiKSnd5u_uUz_mSqskdmlw_hlAzuMCD3S9rv1HOTQbw","query_state":"awaiting_data","session_id":null,"statement":"\r\n                        select\r\n                            gender,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by gender","user":{"name":"Andrei Bozântan"},"rows":[]}}
- request:
    method: GET
    uri: https://attack.aircloak.com/api/queries/355f98ed-57a1-4057-82ef-304642fc2198
    body:
      encoding: ''
      text: ""
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:37 GMT
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZOcxN4BGthg6d2eB
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"buckets_link":"/queries/355f98ed-57a1-4057-82ef-304642fc2198/buckets","completed":true,"data_source":{"name":"gda_banking"},"data_source_id":9,"id":"355f98ed-57a1-4057-82ef-304642fc2198","inserted_at":"2020-02-12T20:42:35.453172","private_permalink":"/permalink/private/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAHcHJpdmF0ZWQABXF1ZXJ5bQAAACQzNTVmOThlZC01N2ExLTQwNTctODJlZi0zMDQ2NDJmYzIxOThkAAZzaWduZWRuBgBqqSM7cAE.zxRp7DzOcvrsWWYCTtJu-79EGc3OPGX1zPsthsVDtVA","public_permalink":"/permalink/public/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAGcHVibGljZAAFcXVlcnltAAAAJDM1NWY5OGVkLTU3YTEtNDA1Ny04MmVmLTMwNDY0MmZjMjE5OGQABnNpZ25lZG4GAGqpIztwAQ.ThDfU_NnrrWeyb-angBifavVk9tqlFtStgDYy8gE82c","query_state":"completed","session_id":null,"statement":"\r\n                        select\r\n                            gender,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by gender","user":{"name":"Andrei Bozântan"},"columns":["gender","count","count_noise"],"error":null,"info":["[Debug] Using statistics-based anonymization.","[Debug] Query executed in 0.308 seconds."],"log":"2020-02-12 20:42:35.000 [debug] Running statement `\r\n                        select\r\n                            gender,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by gender` ...\n2020-02-12 20:42:35.000 [debug] Query 355f98ed-57a1-4057-82ef-304642fc2198 state changed to: parsing...\n2020-02-12 20:42:35.000 [debug] Query 355f98ed-57a1-4057-82ef-304642fc2198 state changed to: compiling...\n2020-02-12 20:42:35.000 [debug] Query 355f98ed-57a1-4057-82ef-304642fc2198 state changed to: awaiting_data...\n2020-02-12 20:42:35.000 [debug] Offloading query ...: `SELECT \"__ac_regular_stats\".\"__ac_count_duid\",\"__ac_regular_stats\".\"__ac_group_0\",\"__ac_regular_stats\".\"__ac_agg_0_count\",\"__ac_regular_stats\".\"__ac_agg_0_sum\",\"__ac_regular_stats\".\"__ac_agg_0_min\",\"__ac_regular_stats\".\"__ac_agg_0_max\",\"__ac_regular_stats\".\"__ac_agg_0_stddev\",\"__ac_regular_stats\".\"__ac_grouping_id\",\"__ac_regular_stats\".\"__ac_min_uid\",\"__ac_regular_stats\".\"__ac_max_uid\",\"__ac_regular_stats\".\"__ac_nlc__1\" AS \"__ac_nlc__1\" FROM (SELECT \"__ac_uid_grouping\".\"__ac_grouping_id\" AS \"__ac_grouping_id\",\"__ac_uid_grouping\".\"__ac_group_0\" AS \"__ac_group_0\",COUNT(\"__ac_uid_grouping\".\"uid\") AS \"__ac_count_duid\",MIN(\"__ac_uid_grouping\".\"uid\") AS \"__ac_min_uid\",MAX(\"__ac_uid_grouping\".\"uid\") AS \"__ac_max_uid\",COUNT(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_count\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_sum\",MIN(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_min\",MAX(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_max\",STDDEV(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_stddev\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_nlc__1\" FROM (SELECT \"loans\".\"uid\" AS \"uid\",\"loans\".\"gender\" AS \"__ac_group_0\",COUNT(*) AS \"__ac_agg_0\",0 AS \"__ac_grouping_id\" FROM \"loans\" WHERE NOT (\"loans\".\"uid\" IS NULL) GROUP BY \"loans\".\"uid\", \"loans\".\"gender\") AS \"__ac_uid_grouping\" GROUP BY \"__ac_uid_grouping\".\"__ac_grouping_id\", \"__ac_uid_grouping\".\"__ac_group_0\") AS \"__ac_regular_stats\" GROUP BY \"__ac_regular_stats\".\"__ac_group_0\"` ...\n2020-02-12 20:42:35.000 [debug] Selecting data ...\n2020-02-12 20:42:35.000 [debug] Acquiring connection to `gda_banking` ...\n2020-02-12 20:42:35.000 [debug] Anonymizing query result ...\n2020-02-12 20:42:35.000 [debug] Executing SQL query: SELECT \"__ac_regular_stats\".\"__ac_count_duid\",\"__ac_regular_stats\".\"__ac_group_0\",\"__ac_regular_stats\".\"__ac_agg_0_count\",\"__ac_regular_stats\".\"__ac_agg_0_sum\",\"__ac_regular_stats\".\"__ac_agg_0_min\",\"__ac_regular_stats\".\"__ac_agg_0_max\",\"__ac_regular_stats\".\"__ac_agg_0_stddev\",\"__ac_regular_stats\".\"__ac_grouping_id\",\"__ac_regular_stats\".\"__ac_min_uid\",\"__ac_regular_stats\".\"__ac_max_uid\",\"__ac_regular_stats\".\"__ac_nlc__1\" AS \"__ac_nlc__1\" FROM (SELECT \"__ac_uid_grouping\".\"__ac_grouping_id\" AS \"__ac_grouping_id\",\"__ac_uid_grouping\".\"__ac_group_0\" AS \"__ac_group_0\",COUNT(\"__ac_uid_grouping\".\"uid\") AS \"__ac_count_duid\",MIN(\"__ac_uid_grouping\".\"uid\") AS \"__ac_min_uid\",MAX(\"__ac_uid_grouping\".\"uid\") AS \"__ac_max_uid\",COUNT(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_count\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_sum\",MIN(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_min\",MAX(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_max\",STDDEV(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_stddev\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_nlc__1\" FROM (SELECT \"loans\".\"uid\" AS \"uid\",\"loans\".\"gender\" AS \"__ac_group_0\",COUNT(*) AS \"__ac_agg_0\",0 AS \"__ac_grouping_id\" FROM \"loans\" WHERE NOT (\"loans\".\"uid\" IS NULL) GROUP BY \"loans\".\"uid\", \"loans\".\"gender\") AS \"__ac_uid_grouping\" GROUP BY \"__ac_uid_grouping\".\"__ac_grouping_id\", \"__ac_uid_grouping\".\"__ac_group_0\") AS \"__ac_regular_stats\"\n2020-02-12 20:42:35.000 [debug] Query 355f98ed-57a1-4057-82ef-304642fc2198 state changed to: ingesting_data...\n2020-02-12 20:42:35.000 [debug] Terminating streamer process\n2020-02-12 20:42:35.000 [debug] Returning the connection to the pool\n2020-02-12 20:42:35.000 [debug] Initializing anonymizer ...\n2020-02-12 20:42:35.000 [debug] Query 355f98ed-57a1-4057-82ef-304642fc2198 state changed to: processing...\n2020-02-12 20:42:35.000 [debug] Processing low count users ...\n2020-02-12 20:42:35.000 [debug] Aggregating groups ...\n2020-02-12 20:42:35.000 [debug] Making explicit buckets ...\n2020-02-12 20:42:35.000 [debug] Query 355f98ed-57a1-4057-82ef-304642fc2198 state changed to: post_processing...\n2020-02-12 20:42:35.000 [info] JSON_LOG {\"execution_time\":309,\"query_id\":\"355f98ed-57a1-4057-82ef-304642fc2198\",\"status\":\"Successful.\",\"type\":\"query_complete\"}\n2020-02-12 20:42:35.000 [info] query finished\n","row_count":2,"types":["text","integer","real"],"rows":[{"unreliable":false,"row":["Female",416,1.4000000000000001],"occurrences":1},{"unreliable":false,"row":["Male",408,1.4000000000000001],"occurrences":1}]}}
