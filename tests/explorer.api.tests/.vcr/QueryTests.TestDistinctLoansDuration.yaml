httpInteractions:
- request:
    method: POST
    uri: https://attack.aircloak.com/api/queries
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"statement":"\r\n                        select\r\n                            duration,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by duration","data_source_name":"gda_banking"}}
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:43 GMT
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZjKRzI5_VyY6d2yB
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
      Content-Length:
      - 66
    body:
      encoding: UTF8-8BIT
      text: |-
        {"success":true,"query_id":"406cb132-6ca1-4356-913f-b84ba0702f1e"}
- request:
    method: GET
    uri: https://attack.aircloak.com/api/queries/406cb132-6ca1-4356-913f-b84ba0702f1e
    body:
      encoding: ''
      text: ""
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:43 GMT
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZjxXZSp_VyY23z4D
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"buckets_link":"/queries/406cb132-6ca1-4356-913f-b84ba0702f1e/buckets","completed":false,"data_source":{"name":"gda_banking"},"data_source_id":9,"id":"406cb132-6ca1-4356-913f-b84ba0702f1e","inserted_at":"2020-02-12T20:42:43.361757","private_permalink":"/permalink/private/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAHcHJpdmF0ZWQABXF1ZXJ5bQAAACQ0MDZjYjEzMi02Y2ExLTQzNTYtOTEzZi1iODRiYTA3MDJmMWVkAAZzaWduZWRuBgDEvyM7cAE.xcCdp5vOQ3oJFjMZWedn0JC52rfPJsZVxJDHhPih11c","public_permalink":"/permalink/public/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAGcHVibGljZAAFcXVlcnltAAAAJDQwNmNiMTMyLTZjYTEtNDM1Ni05MTNmLWI4NGJhMDcwMmYxZWQABnNpZ25lZG4GAMS_IztwAQ.Dmg3q-Z35FYkuWK-oTDWnn2asr58KvYmMWWMdDTBRRU","query_state":"processing","session_id":null,"statement":"\r\n                        select\r\n                            duration,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by duration","user":{"name":"Andrei Bozântan"},"rows":[]}}
- request:
    method: GET
    uri: https://attack.aircloak.com/api/queries/406cb132-6ca1-4356-913f-b84ba0702f1e
    body:
      encoding: ''
      text: ""
    headers:
      auth-token:
      - SFMyNTY.g3QAAAACZAAEZGF0YW0AAAAkNWEwOGU5MGUtODJjOC00ZmY2LTkyZmItNGJmN2E2ZTY3YjdhZAAGc2lnbmVkbgYA-oOX9W8B.55CiWZ7Jx1oUBq6t-rHU_VGA1jPtIMzHGzgq49Xcrm8
  response:
    status:
      code: 200
      message: OK
    headers:
      Server:
      - nginx/1.6.2
      Date:
      - Wed, 12 Feb 2020 20:42:45 GMT
      Transfer-Encoding:
      - chunked
      Connection:
      - keep-alive
      Cache-Control:
      - must-revalidate, max-age=0, private
      X-Request-ID:
      - FfLCZrycS5B_VyY6d21B
      Strict-Transport-Security:
      - max-age=31556926; includeSubdomains
      Content-Type:
      - application/json; charset=utf-8
    body:
      encoding: UTF8-8BIT
      text: |-
        {"query":{"buckets_link":"/queries/406cb132-6ca1-4356-913f-b84ba0702f1e/buckets","completed":true,"data_source":{"name":"gda_banking"},"data_source_id":9,"id":"406cb132-6ca1-4356-913f-b84ba0702f1e","inserted_at":"2020-02-12T20:42:43.361757","private_permalink":"/permalink/private/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAHcHJpdmF0ZWQABXF1ZXJ5bQAAACQ0MDZjYjEzMi02Y2ExLTQzNTYtOTEzZi1iODRiYTA3MDJmMWVkAAZzaWduZWRuBgAtyCM7cAE.NKIFZEXWI2FEEocjyHOXlxyRT0krt8JY-2-9xaqOZaA","public_permalink":"/permalink/public/query/SFMyNTY.g3QAAAACZAAEZGF0YWgDZAAGcHVibGljZAAFcXVlcnltAAAAJDQwNmNiMTMyLTZjYTEtNDM1Ni05MTNmLWI4NGJhMDcwMmYxZWQABnNpZ25lZG4GAC7IIztwAQ.ENeK5TCTKyf4sm2pnwN2FXsuKN36BdEI4t1WjFy06y4","query_state":"completed","session_id":null,"statement":"\r\n                        select\r\n                            duration,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by duration","user":{"name":"Andrei Bozântan"},"columns":["duration","count","count_noise"],"error":null,"info":["[Debug] Using statistics-based anonymization.","[Debug] Query executed in 0.096 seconds."],"log":"2020-02-12 20:42:43.000 [debug] Running statement `\r\n                        select\r\n                            duration,\r\n                            count(*),\r\n                            count_noise(*)\r\n                        from loans\r\n                        group by duration` ...\n2020-02-12 20:42:43.000 [debug] Query 406cb132-6ca1-4356-913f-b84ba0702f1e state changed to: parsing...\n2020-02-12 20:42:43.000 [debug] Query 406cb132-6ca1-4356-913f-b84ba0702f1e state changed to: compiling...\n2020-02-12 20:42:43.000 [debug] Query 406cb132-6ca1-4356-913f-b84ba0702f1e state changed to: awaiting_data...\n2020-02-12 20:42:43.000 [debug] Offloading query ...: `SELECT \"__ac_regular_stats\".\"__ac_count_duid\",\"__ac_regular_stats\".\"__ac_group_0\",\"__ac_regular_stats\".\"__ac_agg_0_count\",\"__ac_regular_stats\".\"__ac_agg_0_sum\",\"__ac_regular_stats\".\"__ac_agg_0_min\",\"__ac_regular_stats\".\"__ac_agg_0_max\",\"__ac_regular_stats\".\"__ac_agg_0_stddev\",\"__ac_regular_stats\".\"__ac_grouping_id\",\"__ac_regular_stats\".\"__ac_min_uid\",\"__ac_regular_stats\".\"__ac_max_uid\",\"__ac_regular_stats\".\"__ac_nlc__1\" AS \"__ac_nlc__1\" FROM (SELECT \"__ac_uid_grouping\".\"__ac_grouping_id\" AS \"__ac_grouping_id\",\"__ac_uid_grouping\".\"__ac_group_0\" AS \"__ac_group_0\",COUNT(\"__ac_uid_grouping\".\"uid\") AS \"__ac_count_duid\",MIN(\"__ac_uid_grouping\".\"uid\") AS \"__ac_min_uid\",MAX(\"__ac_uid_grouping\".\"uid\") AS \"__ac_max_uid\",COUNT(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_count\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_sum\",MIN(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_min\",MAX(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_max\",STDDEV(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_stddev\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_nlc__1\" FROM (SELECT \"loans\".\"uid\" AS \"uid\",CASE WHEN \"loans\".\"duration\" < 1 THEN 1 WHEN \"loans\".\"duration\" > 1000 THEN 1000 ELSE \"loans\".\"duration\" END AS \"__ac_group_0\",COUNT(*) AS \"__ac_agg_0\",0 AS \"__ac_grouping_id\" FROM \"loans\" WHERE NOT (\"loans\".\"uid\" IS NULL) GROUP BY \"loans\".\"uid\", CASE WHEN \"loans\".\"duration\" < 1 THEN 1 WHEN \"loans\".\"duration\" > 1000 THEN 1000 ELSE \"loans\".\"duration\" END) AS \"__ac_uid_grouping\" GROUP BY \"__ac_uid_grouping\".\"__ac_grouping_id\", \"__ac_uid_grouping\".\"__ac_group_0\") AS \"__ac_regular_stats\" GROUP BY \"__ac_regular_stats\".\"__ac_group_0\"` ...\n2020-02-12 20:42:43.000 [debug] Selecting data ...\n2020-02-12 20:42:43.000 [debug] Acquiring connection to `gda_banking` ...\n2020-02-12 20:42:43.000 [debug] Anonymizing query result ...\n2020-02-12 20:42:43.000 [debug] Executing SQL query: SELECT \"__ac_regular_stats\".\"__ac_count_duid\",\"__ac_regular_stats\".\"__ac_group_0\",\"__ac_regular_stats\".\"__ac_agg_0_count\",\"__ac_regular_stats\".\"__ac_agg_0_sum\",\"__ac_regular_stats\".\"__ac_agg_0_min\",\"__ac_regular_stats\".\"__ac_agg_0_max\",\"__ac_regular_stats\".\"__ac_agg_0_stddev\",\"__ac_regular_stats\".\"__ac_grouping_id\",\"__ac_regular_stats\".\"__ac_min_uid\",\"__ac_regular_stats\".\"__ac_max_uid\",\"__ac_regular_stats\".\"__ac_nlc__1\" AS \"__ac_nlc__1\" FROM (SELECT \"__ac_uid_grouping\".\"__ac_grouping_id\" AS \"__ac_grouping_id\",\"__ac_uid_grouping\".\"__ac_group_0\" AS \"__ac_group_0\",COUNT(\"__ac_uid_grouping\".\"uid\") AS \"__ac_count_duid\",MIN(\"__ac_uid_grouping\".\"uid\") AS \"__ac_min_uid\",MAX(\"__ac_uid_grouping\".\"uid\") AS \"__ac_max_uid\",COUNT(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_count\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_sum\",MIN(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_min\",MAX(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_max\",STDDEV(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_agg_0_stddev\",SUM(\"__ac_uid_grouping\".\"__ac_agg_0\") AS \"__ac_nlc__1\" FROM (SELECT \"loans\".\"uid\" AS \"uid\",CASE WHEN \"loans\".\"duration\" < 1 THEN 1 WHEN \"loans\".\"duration\" > 1000 THEN 1000 ELSE \"loans\".\"duration\" END AS \"__ac_group_0\",COUNT(*) AS \"__ac_agg_0\",0 AS \"__ac_grouping_id\" FROM \"loans\" WHERE NOT (\"loans\".\"uid\" IS NULL) GROUP BY \"loans\".\"uid\", CASE WHEN \"loans\".\"duration\" < 1 THEN 1 WHEN \"loans\".\"duration\" > 1000 THEN 1000 ELSE \"loans\".\"duration\" END) AS \"__ac_uid_grouping\" GROUP BY \"__ac_uid_grouping\".\"__ac_grouping_id\", \"__ac_uid_grouping\".\"__ac_group_0\") AS \"__ac_regular_stats\"\n2020-02-12 20:42:43.000 [debug] Query 406cb132-6ca1-4356-913f-b84ba0702f1e state changed to: ingesting_data...\n2020-02-12 20:42:43.000 [debug] Terminating streamer process\n2020-02-12 20:42:43.000 [debug] Returning the connection to the pool\n2020-02-12 20:42:43.000 [debug] Initializing anonymizer ...\n2020-02-12 20:42:43.000 [debug] Query 406cb132-6ca1-4356-913f-b84ba0702f1e state changed to: processing...\n2020-02-12 20:42:43.000 [debug] Processing low count users ...\n2020-02-12 20:42:43.000 [debug] Aggregating groups ...\n2020-02-12 20:42:43.000 [debug] Making explicit buckets ...\n2020-02-12 20:42:43.000 [debug] Query 406cb132-6ca1-4356-913f-b84ba0702f1e state changed to: post_processing...\n2020-02-12 20:42:43.000 [info] JSON_LOG {\"execution_time\":96,\"query_id\":\"406cb132-6ca1-4356-913f-b84ba0702f1e\",\"status\":\"Successful.\",\"type\":\"query_complete\"}\n2020-02-12 20:42:43.000 [info] query finished\n","row_count":5,"types":["integer","integer","real"],"rows":[{"unreliable":false,"row":[12,165,1.4000000000000001],"occurrences":1},{"unreliable":false,"row":[24,167,1.4000000000000001],"occurrences":1},{"unreliable":false,"row":[36,156,1.4000000000000001],"occurrences":1},{"unreliable":false,"row":[48,162,1.4000000000000001],"occurrences":1},{"unreliable":false,"row":[60,174,1.4000000000000001],"occurrences":1}]}}
